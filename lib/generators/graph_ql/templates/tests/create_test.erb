RSpec.describe 'Create<%= @camelize_name %>', type: :request do
  include_context 'authenticated user'

  def query()
  <%= "  <<~GQL" %>
    mutation Create<%= @camelize_name %>(<%= @create_test_define_line %>) {
      create<%= @camelize_name %>(input: {<%= @create_test_input_line %>}) {
          id
          <%= 
            @parsed_fields.map{|field| 
              var = field[:name].camelize
              var[0] = var[0].downcase
              var
            }.join("\n          ")
          %>
        }
      }
    GQL
  end

  it 'create_<%= @snake_case_name %> success' do
    <%= @snake_case_name%> = build(:<%= @snake_case_name %>)
    variables = as_json(<%= @snake_case_name%>)

    json = graphql(query, variables: variables)
    data = json['create<%= @camelize_name %>']

    expect(data).to include('id' => be_present)
  end
end
